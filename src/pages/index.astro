---
import { fetchGraphQL } from "../lib/graphql";
import { GET_PAGE_BY_SLUG } from "../lib/queries";
import { Button } from "../components/ui/Button";
import { getBaseUrl } from "../lib/utils";
import "../styles/global.css";

const baseUrl = getBaseUrl();

// Fetch the popup page data
const popupData = await fetchGraphQL<any>(GET_PAGE_BY_SLUG, {
  slug: "popup",
}).catch(() => null);

const popup = popupData?.page || null;
const featuredImage = popup?.featuredImage?.node?.sourceUrl;
const featuredImageAlt = popup?.featuredImage?.node?.altText || popup?.title || "";
const pageContent = popup?.content || "";

const canonicalURL = new URL(Astro.url.pathname, Astro.site);

const pageTitle = "Food Focus Thailand | Be Media Focus";
const pageDescription = "Discover more about the no. 1 leading industry-focused magazine for food & beverage from Food Focus Thailand";

---

<!doctype html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href={`${baseUrl}favicon.svg`} />
    <link rel="canonical" href={canonicalURL} />

    <!-- Primary Meta Tags -->
    <title>{pageTitle}</title>
    <meta name="title" content={pageTitle} />
    <meta name="description" content={pageDescription} />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={pageTitle} />
    <meta property="og:description" content={pageDescription} />
    <meta property="og:image" content={featuredImage} />
    <meta property="og:locale" content="th_TH" />
    <meta property="og:site_name" content={pageTitle} />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content={canonicalURL} />
    <meta name="twitter:title" content={pageTitle} />
    <meta name="twitter:description" content={pageDescription} />
    <meta name="twitter:image" content={featuredImage} />
  </head>
  <body class="min-h-screen flex items-center justify-center bg-black text-white">
    <div class="max-w-2xl mx-auto px-4 py-8 text-center">
      {featuredImage && (
        <div class="mb-8 flex justify-center">
          <img
            src={featuredImage}
            alt={featuredImageAlt}
            class="max-w-full h-auto"
          />
        </div>
      )}

      {pageContent && (
        <div
          class="prose prose-invert prose-lg mx-auto mb-8 text-center *:text-center"
          set:html={pageContent}
        />
      )}

      <div class="flex justify-center">
        <Button variant="primary" size="lg" client:load id="enter-button" className="cursor-pointer">
          Enter Website
        </Button>
      </div>
    </div>

    <script define:vars={{ baseUrl }}>
      document.addEventListener('DOMContentLoaded', () => {
        const button = document.getElementById('enter-button');
        if (button) {
          button.addEventListener('click', async () => {
            // Call tracking URL
            try {
              await fetch('https://www.foodfocusthailand.com/click.php?id=Eblast0118_NEWWEB', {
                mode: 'no-cors'
              });
            } catch (error) {
              console.log('Tracking call failed:', error);
            }

            // Navigate to home page
            window.location.href = `${baseUrl}home`;
          });
        }
      });
    </script>
  </body>
</html>
