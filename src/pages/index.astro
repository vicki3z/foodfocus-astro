---
import { fetchGraphQL } from "../lib/graphql";
import { GET_PAGE_BY_SLUG } from "../lib/queries";
import { Button } from "../components/ui/Button";
import "../styles/global.css";

// Fetch the popup page data
const popupData = await fetchGraphQL<any>(GET_PAGE_BY_SLUG, {
  slug: "popup",
}).catch(() => null);

const popup = popupData?.page || null;
const featuredImage = popup?.featuredImage?.node?.sourceUrl;
const featuredImageAlt = popup?.featuredImage?.node?.altText || popup?.title || "";
const pageTitle = popup?.title || "Food Focus Thailand";
const pageContent = popup?.content || "";
---

<!doctype html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>{pageTitle} | Food Focus Thailand</title>
    <meta name="description" content="Food Focus Thailand" />
  </head>
  <body class="min-h-screen flex items-center justify-center bg-black text-white">
    <div class="max-w-2xl mx-auto px-4 py-8 text-center">
      {featuredImage && (
        <div class="mb-8 flex justify-center">
          <img
            src={featuredImage}
            alt={featuredImageAlt}
            class="max-w-full h-auto"
          />
        </div>
      )}

      {pageContent && (
        <div
          class="prose prose-invert prose-lg mx-auto mb-8 text-center *:text-center"
          set:html={pageContent}
        />
      )}

      <div class="flex justify-center">
        <Button variant="primary" size="lg" client:load id="enter-button" className="cursor-pointer">
          Enter Website
        </Button>
      </div>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const button = document.getElementById('enter-button');
        if (button) {
          button.addEventListener('click', async () => {
            // Call tracking URL
            try {
              await fetch('https://www.foodfocusthailand.com/click.php?id=Eblast0118_NEWWEB', {
                mode: 'no-cors'
              });
            } catch (error) {
              console.log('Tracking call failed:', error);
            }

            // Navigate to home page
            window.location.href = '/home';
          });
        }
      });
    </script>
  </body>
</html>
