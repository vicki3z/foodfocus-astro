---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { Header } from "../../components/layout/Header";
import Footer from "../../components/layout/Footer.astro";
import Container from "../../components/layout/Container.astro";
import { getBaseUrl } from "../../lib/utils";
import { fetchGraphQL } from "../../lib/graphql";
import { GET_EVENT_YEARS } from "../../lib/queries";

const baseUrl = getBaseUrl();

// Fetch available years from taxonomy
const yearsData = await fetchGraphQL<any>(GET_EVENT_YEARS).catch(() => null);
const availableYears = (yearsData?.eventYears?.nodes || [])
  .map((node: any) => parseInt(node.name))
  .sort((a: number, b: number) => b - a);

// Get the latest year or default to current year
const latestYear = availableYears[0] || new Date().getFullYear();
const redirectUrl = `${baseUrl}exclusive-events/${latestYear}`;
---

<BaseLayout title="Exclusive Events" description="Dedicated to be the industry-focused platform for Food & Beverage Industry in Thailand, with the expertise in organizing Food Focus Thailand Roadmap, we also organized seminar & conferences that definitely meet the partnersâ€™ needs.">
  <Fragment slot="head">
    <meta http-equiv="refresh" content={`0; url=${redirectUrl}`} />
    <script is:inline set:html={`window.location.href = ${JSON.stringify(redirectUrl)};`}></script>
  </Fragment>

  <Header client:load slot="header" />

  <Container class="py-16">
    <div class="text-center">
      <div class="mb-4">
        <svg class="animate-spin h-12 w-12 mx-auto text-[var(--color-primary)]" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
      </div>
      <h1 class="text-2xl font-bold text-[var(--color-text-dark)] mb-2">Redirecting...</h1>
      <p class="text-[var(--color-text-muted)]">
        Taking you to <a href={redirectUrl} class="text-[var(--color-primary)] hover:underline">Seminars {latestYear}</a>
      </p>
    </div>
  </Container>

  <Footer slot="footer" />
</BaseLayout>
