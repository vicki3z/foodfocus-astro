---
import { Tag } from "./Tag.tsx";

interface Props {
  image: string;
  imageAlt?: string;
  category?: string;
  categorySlug?: string;
  title: string;
  excerpt?: string;
  date?: string;
  href?: string;
  variant?: "vertical" | "horizontal";
  class?: string;
}

const {
  image,
  imageAlt = "",
  category,
  categorySlug,
  title,
  excerpt,
  date,
  href,
  variant = "vertical",
  class: className = "",
} = Astro.props;

const formattedDate = date
  ? new Date(date).toLocaleDateString("en-GB", {
      year: "numeric",
      month: "long",
      day: "numeric",
      timeZone: "Asia/Bangkok",
    })
  : null;

const cleanExcerpt = excerpt
  ? excerpt.replace(/<[^>]*>/g, "").replace(/&nbsp;/g, " ")
  : undefined;

const Comp = href ? "a" : "div";
---

{
  variant === "vertical" ? (
    <Comp
      href={href}
      class:list={[
        "group block bg-white rounded-lg overflow-hidden p-4",
        className,
      ]}
    >
      <div class="aspect-[16/10] overflow-hidden">
        <img
          src={image}
          alt={imageAlt || title}
          class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300 rounded-md"
          loading="lazy"
        />
      </div>
      <div class="py-4">
        {category && (
          <Tag variant="primary" size="sm" className="mb-2">
            {category}
          </Tag>
        )}
        <h3 class="font-semibold text-[var(--color-text-dark)] line-clamp-2 mb-2 group-hover:text-[var(--color-primary)] transition-colors">
          {title}
        </h3>
        {cleanExcerpt && (
          <p class="text-sm text-[var(--color-text-muted)] line-clamp-3 mb-2 tracking-wide">
            {cleanExcerpt}
          </p>
        )}
        {formattedDate && (
          <time class="text-xs text-[var(--color-text-muted)]" datetime={date}>
            {formattedDate}
          </time>
        )}
      </div>
    </Comp>
  ) : (
    <Comp
      href={href}
      class:list={[
        "group flex gap-4 bg-white rounded-lg overflow-hidden p-4",
        className,
      ]}
    >
      <div class="flex-shrink-0 w-52 overflow-hidden rounded-lg">
        <img
          src={image}
          alt={imageAlt || title}
          class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300 rounded-md"
          loading="lazy"
        />
      </div>
      <div class="flex flex-col flex-1 p-2 gap-3">
        <div class="flex justify-between items-center">
          {category && (
            <Tag variant="primary" size="sm">
              {category}
            </Tag>
          )}
          {formattedDate && (
            <time
              class="flex items-center gap-1.5 text-xs font-medium text-[var(--color-text-muted)]"
              datetime={date}
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="currentColor"
                class="size-4"
              >
                <path
                  fill-rule="evenodd"
                  d="M6.75 2.25A.75.75 0 0 1 7.5 3v1.5h9V3A.75.75 0 0 1 18 3v1.5h.75a3 3 0 0 1 3 3v11.25a3 3 0 0 1-3 3H5.25a3 3 0 0 1-3-3V7.5a3 3 0 0 1 3-3H6V3a.75.75 0 0 1 .75-.75Zm13.5 9a1.5 1.5 0 0 0-1.5-1.5H5.25a1.5 1.5 0 0 0-1.5 1.5v7.5a1.5 1.5 0 0 0 1.5 1.5h13.5a1.5 1.5 0 0 0 1.5-1.5v-7.5Z"
                  clip-rule="evenodd"
                />
              </svg>

              {formattedDate}
            </time>
          )}
        </div>

        <div class="flex flex-col gap-1">
          <h3 class="font-semibold text-sm text-[var(--color-text-dark)] line-clamp-2 group-hover:text-[var(--color-primary)] transition-colors">
            {title}
          </h3>
          {cleanExcerpt && (
            <p class="text-sm text-[var(--color-text-muted)] line-clamp-3 mb-2 tracking-wide">
              {cleanExcerpt}
            </p>
          )}
        </div>
      </div>
    </Comp>
  )
}
